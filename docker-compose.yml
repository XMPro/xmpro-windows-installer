services:
  smdbmigrate:
    image: ${REGISTRY_URL:-xmprononprod.azurecr.io}/smdbmigrate:${REGISTRY_VERSION:-4.5.0.136-alpha-28faa02bab}
    depends_on:
      smdb:
        condition: service_completed_successfully
    environment:
      - SMDB_CONNECTIONSTRING=Server=${DB_PROTOCOL:-tcp}:${DB_SERVER:-host.docker.internal};Encrypt=${DB_ENCRYPT:-true};TrustServerCertificate=${DB_TRUST_SERVER_CERTIFICATE:-true};PersistSecurityInfo=${DB_PERSIST_SECURITY_INFO:-false};Database=SM;User=${SMDB_USER:-someSmDbUser};Password=${SMDB_PASSWORD:-someSmDbPassword!}
      - COMPANY_NAME=${COMPANY_NAME:-Evaluation}
      - COMPANY_ADMIN_FIRSTNAME=${COMPANY_ADMIN_FIRSTNAME:-SomeCompanyAdminFirstName}
      - COMPANY_ADMIN_SURNAME=${COMPANY_ADMIN_SURNAME:-SomeCompanyAdminSurname}
      - COMPANY_ADMIN_EMAILADDRESS=${COMPANY_ADMIN_EMAILADDRESS:-evaluation@xmpro.com}
      - COMPANY_ADMIN_USERNAME=${COMPANY_ADMIN_USERNAME:-admin@somecompany.example.com}
      - COMPANY_ADMIN_PASSWORD=${COMPANY_ADMIN_PASSWORD:-EBhxyO9Po=$COMPANY_ADMIN_PASSWORDd}
      - SITE_ADMIN_PASSWORD=${SITE_ADMIN_PASSWORD:-T$q8[K:+?]v7}
      - AD_BASEURL_CLIENT=${AD_BASEURL_CLIENT:-https://localhost:5202/}
      - AI_BASEURL_CLIENT=$AI_BASEURL_CLIENT
      - DS_BASEURL_CLIENT=${DS_BASEURL_CLIENT:-https://localhost:5203/}
      - XMPRO_NOTEBOOK_BASEURL_CLIENT=$XMPRO_NOTEBOOK_BASEURL_CLIENT
      - AD_PRODUCT_ID=${AD_PRODUCT_ID:-fe011f90-5bb6-80ad-b0a2-56300bf3b65d}
      - AI_PRODUCT_ID=${AI_PRODUCT_ID:-b7be889b-01d3-4bd2-95c6-511017472ec8}
      - DS_PRODUCT_ID=${DS_PRODUCT_ID:-71435803-967a-e9ac-574c-face863f7ec0}
      - SM_PRODUCT_ID=${SM_PRODUCT_ID:-380129dd-6ac3-47fc-a399-234394977680}
      - XMPRO_NOTEBOOK_PRODUCT_ID=${XMPRO_NOTEBOOK_PRODUCT_ID:-c6de3c46-e8ab-4c71-8787-947e6fd2292c}
      - AD_PRODUCT_KEY=${AD_PRODUCT_KEY:-53517a73-ab38-2336-934a-05d2ed5bbb6d}
      - AI_PRODUCT_KEY=${AI_PRODUCT_KEY:-ad81e538-8417-ef92-ea08-6cc3a4e8e3a0}
      - DS_PRODUCT_KEY=${DS_PRODUCT_KEY:-0b45acc9-0a52-0905-ac76-b3af5d1f14ad}
      - XMPRO_NOTEBOOK_PRODUCT_KEY=${XMPRO_NOTEBOOK_PRODUCT_KEY:-e62c1409-c331-aae1-2412-f8b5df75d470}
      - AI_PRODUCT_ENABLE=${AI_PRODUCT_ENABLE:-true}
  licenses:
    image: ${REGISTRY_URL:-xmprononprod.azurecr.io}/licenses:${REGISTRY_VERSION:-4.5.0.136-alpha-28faa02bab}
    depends_on:
      smdbmigrate:
        condition: service_completed_successfully
    environment:
      - SQLCMDSERVER=${DB_PROTOCOL:-tcp}:${DB_SERVER:-host.docker.internal}
      - SQLCMDENCRYPT=${DB_ENCRYPT:-true}
      - SQLCMDTRUSTSERVERCERTIFICATE=${DB_TRUST_SERVER_CERTIFICATE:-true}
      - SQLCMDUSER=${DB_SA_USER:-sa}
      - SQLCMDPASSWORD=${DB_SA_PASSWORD:-someSaPassword!}
      - SQLCMDDBNAME=master
    
      - SMDB_USER=${SMDB_USER:-someSmDbUser}
      - SMDB_PASSWORD=${SMDB_PASSWORD:-someSmDbPassword!}
      - COMPANY_ADMIN_EMAILADDRESS=${COMPANY_ADMIN_EMAILADDRESS:-evaluation@xmpro.com}
      - COMPANY_ID=${COMPANY_ID:-2}
      - LICENSE_API_URL=${LICENSE_API_URL:-https://fa-xmrlicense-nonprod.azurewebsites.net/api/license}
      - DS_PRODUCT_ID=${DS_PRODUCT_ID:-71435803-967a-e9ac-574c-face863f7ec0}
      - AD_PRODUCT_ID=${AD_PRODUCT_ID:-fe011f90-5bb6-80ad-b0a2-56300bf3b65d}
  ad:
    image: ${REGISTRY_URL:-xmprononprod.azurecr.io}/ad:${REGISTRY_VERSION:-4.5.0.136-alpha-28faa02bab}
    depends_on:
      addbmigrate:
        condition: service_completed_successfully
      addb:
        condition: service_completed_successfully
    ports:
      - "${AD_PORT:-5202}:8443"
    restart: unless-stopped
    environment:
      - ASPNETCORE_ENVIRONMENT=dev
      - ASPNETCORE_Kestrel__Certificates__Default__Path=${ASPNETCORE_Kestrel__Certificates__Default__Path:-/certs/ad.pfx}
      - ASPNETCORE_Kestrel__Certificates__Default__Password=${ASPNETCORE_Kestrel__Certificates__Default__Password:-}
      - xm__serilog__minimumlevel__default=${AD_LOG_LEVEL:-Information}
      - xm__xmpro__appDesigner__featureFlags__dbMigrationsEnabled=false
      - xm__xmpro__appDesigner__featureFlags__enableHealthChecks=false
      - xm__xmpro__appDesigner__featureFlags__enableLogging=true
      - xm__xmpro__appDesigner__featureFlags__enableApplicationInsightsTelemetry=false
      - xm__xmpro__xmidentity__server__baseUrl=${SM_BASEURL_SERVER:-https://sm.host/}
      - xm__xmpro__xmidentity__client__baseUrl=${AD_BASEURL_CLIENT:-https://localhost:5202/}
      - xm__xmpro__xmidentity__client__id=${AD_PRODUCT_ID:-fe011f90-5bb6-80ad-b0a2-56300bf3b65d}
      - xm__xmpro__xmidentity__client__sharedkey=${AD_PRODUCT_KEY:-53517a73-ab38-2336-934a-05d2ed5bbb6d}
      - xm__xmpro__dataStreamDesigner__server__baseUrl=${DS_BASEURL_SERVER:-https://ds:8443/}
      - xm__xmpro__appDesigner__server__baseUrl=${AD_BASEURL_SERVER:-https://ad:8443/}
      - xm__xmpro__data__connectionString=Server=${DB_PROTOCOL:-tcp}:${DB_SERVER:-host.docker.internal};Encrypt=${DB_ENCRYPT:-true};TrustServerCertificate=${DB_TRUST_SERVER_CERTIFICATE:-true};PersistSecurityInfo=${DB_PERSIST_SECURITY_INFO:-false};Database=AD;User=${ADDB_USER:-someAdDbUser};Password=${ADDB_PASSWORD:-someAdDbPassword!}
      - xm__xmpro__xmsettings__data__connectionString=Server=${DB_PROTOCOL:-tcp}:${DB_SERVER:-host.docker.internal};Encrypt=${DB_ENCRYPT:-true};TrustServerCertificate=${DB_TRUST_SERVER_CERTIFICATE:-true};PersistSecurityInfo=${DB_PERSIST_SECURITY_INFO:-false};Database=AD;User=${ADDB_USER:-someAdDbUser};Password=${ADDB_PASSWORD:-someAdDbPassword!}
      - xm__xmpro__healthChecks__cssPath=ClientApp/src/assets/content/styles/healthui.css
    volumes:
      - ${CERTIFICATES_DIR:-./certs}/certs:/certs
      - ${CERTIFICATES_DIR:-./certs}/trustedcerts:/trustedcerts
  ds:
    image: ${REGISTRY_URL:-xmprononprod.azurecr.io}/ds:${REGISTRY_VERSION:-4.5.0.136-alpha-28faa02bab}
    depends_on:
      dsdbmigrate:
        condition: service_completed_successfully
      dsdb:
        condition: service_completed_successfully
    ports:
      - "${DS_PORT:-5203}:8443"
    restart: unless-stopped
    environment:
      - ASPNETCORE_ENVIRONMENT=dev
      - ASPNETCORE_Kestrel__Certificates__Default__Path=${ASPNETCORE_Kestrel__Certificates__Default__Path:-/certs/ds.pfx}
      - ASPNETCORE_Kestrel__Certificates__Default__Password=${ASPNETCORE_Kestrel__Certificates__Default__Password:-}
      - xm__serilog__minimumlevel__default=${DS_LOG_LEVEL:-Information}
      - xm__xmpro__data__connectionString=Server=${DB_PROTOCOL:-tcp}:${DB_SERVER:-host.docker.internal};Encrypt=${DB_ENCRYPT:-true};TrustServerCertificate=${DB_TRUST_SERVER_CERTIFICATE:-true};PersistSecurityInfo=${DB_PERSIST_SECURITY_INFO:-false};Database=DS;User=${DSDB_USER:-someDsDbUser};Password=${DSDB_PASSWORD:-someDsDbPassword!}
      - xm__xmpro__xmsettings__data__connectionString=Server=${DB_PROTOCOL:-tcp}:${DB_SERVER:-host.docker.internal};Encrypt=${DB_ENCRYPT:-true};TrustServerCertificate=${DB_TRUST_SERVER_CERTIFICATE:-true};PersistSecurityInfo=${DB_PERSIST_SECURITY_INFO:-false};Database=DS;User=${DSDB_USER:-someDsDbUser};Password=${DSDB_PASSWORD:-someDsDbPassword!}
      - xm__xmpro__dataStreamDesigner__streamHostDownloadBaseUrl=https://download.app.xmpro.com/
      - xm__xmpro__dataStreamDesigner__featureFlags__dbMigrationsEnabled=false
      - xm__xmpro__dataStreamDesigner__featureFlags__enableHealthChecks=false
      - xm__xmpro__dataStreamDesigner__featureFlags__enableApplicationInsightsTelemetry=false
      - xm__xmpro__healthChecks__cssPath=ClientApp/src/assets/content/styles/healthui.css
      - xm__xmpro__xmidentity__server__baseUrl=${SM_BASEURL_SERVER:-https://sm.host/}
      - xm__xmpro__xmidentity__client__id=${DS_PRODUCT_ID:-71435803-967a-e9ac-574c-face863f7ec0}
      - xm__xmpro__xmidentity__client__baseUrl=${DS_BASEURL_CLIENT:-https://localhost:5203/}
      - xm__xmpro__xmidentity__client__sharedkey=${DS_PRODUCT_KEY:-0b45acc9-0a52-0905-ac76-b3af5d1f14ad}
      - xm__xmpro__appDesigner__server__baseUrl=${AD_BASEURL_SERVER:-https://ad:8443/}
    volumes:
      - ${CERTIFICATES_DIR:-./certs}/certs:/certs
      - ${CERTIFICATES_DIR:-./certs}/trustedcerts:/trustedcerts
  addbmigrate:
    image: ${REGISTRY_URL:-xmprononprod.azurecr.io}/addbmigrate:${REGISTRY_VERSION:-4.5.0.136-alpha-28faa02bab}
    depends_on:
      addb:
        condition: service_completed_successfully
    environment:
      - ADDB_CONNECTIONSTRING=Server=${DB_PROTOCOL:-tcp}:${DB_SERVER:-host.docker.internal};Encrypt=${DB_ENCRYPT:-true};TrustServerCertificate=${DB_TRUST_SERVER_CERTIFICATE:-true};PersistSecurityInfo=${DB_PERSIST_SECURITY_INFO:-false};Database=AD;User=${ADDB_USER:-someAdDbUser};Password=${ADDB_PASSWORD:-someAdDbPassword!}
      - DS_BASEURL_CLIENT=${DS_BASEURL_CLIENT:-https://localhost:5203/}
  dsdbmigrate:
    image: ${REGISTRY_URL:-xmprononprod.azurecr.io}/dsdbmigrate:${REGISTRY_VERSION:-4.5.0.136-alpha-28faa02bab}
    depends_on:
      dsdb:
        condition: service_completed_successfully
    environment:
      - DSDB_CONNECTIONSTRING=Server=${DB_PROTOCOL:-tcp}:${DB_SERVER:-host.docker.internal};Encrypt=${DB_ENCRYPT:-true};TrustServerCertificate=${DB_TRUST_SERVER_CERTIFICATE:-true};PersistSecurityInfo=${DB_PERSIST_SECURITY_INFO:-false};Database=DS;User=${DSDB_USER:-someDsDbUser};Password=${DSDB_PASSWORD:-someDsDbPassword!}
      - DSDB_COLLECTION_ID=${DSDB_COLLECTION_ID:-d2243f42-50bf-4b0f-9234-8757844c9602}
      - DSDB_COLLECTION_SECRET=${DSDB_COLLECTION_SECRET:-KUqJypnTqkA0MIgmodXtpfXUgPJAsgCr}
      - DSDB_COLLECTION_NAME=${DSDB_COLLECTION_NAME:-COLLECTION 4.5.0-alpha}
  addb:
    image: ${REGISTRY_URL:-xmprononprod.azurecr.io}/addb:${REGISTRY_VERSION:-4.5.0.136-alpha-28faa02bab}
    environment:
      - SQLCMDSERVER=${DB_PROTOCOL:-tcp}:${DB_SERVER:-host.docker.internal}
      - SQLCMDENCRYPT=${DB_ENCRYPT:-true}
      - SQLCMDTRUSTSERVERCERTIFICATE=${DB_TRUST_SERVER_CERTIFICATE:-true}
      - SQLCMDUSER=${DB_SA_USER:-sa}
      - SQLCMDPASSWORD=${DB_SA_PASSWORD:-someSaPassword!}
    
      - ADDB_USER=${ADDB_USER:-someAdDbUser}
      - ADDB_PASSWORD=${ADDB_PASSWORD:-someAdDbPassword!}
  sh:
    image: ${REGISTRY_URL:-xmprononprod.azurecr.io}/stream-host:${REGISTRY_VERSION:-4.5.0.136-alpha-28faa02bab}
    depends_on:
      ds:
        condition: service_healthy
      dsdb:
        condition: service_completed_successfully
    restart: unless-stopped
    environment:
      - xm__consolelogging__minimumlevel__default=${SH_LOG_LEVEL:-Information}
      - xm__xmpro__gateway__id=${SH_ID:-a39c3157-e38e-e90f-f611-f0ad21100f52}
      - xm__xmpro__gateway__name=${SH_NAME:-vsts-container}
      - xm__xmpro__gateway__serverurl=${DS_BASEURL_SERVER:-https://ds:8443/}
      - xm__xmpro__gateway__collectionid=${DSDB_COLLECTION_ID:-d2243f42-50bf-4b0f-9234-8757844c9602}
      - xm__xmpro__gateway__secret=${DSDB_COLLECTION_SECRET:-KUqJypnTqkA0MIgmodXtpfXUgPJAsgCr}
      - xm__xmpro__gateway__featureFlags__enableApplicationInsightsTelemetry=false
      - xm__xmpro__gateway__featureflags__enablelegacycore=false
      - xm__xmpro__gateway__featureflags__enablelegacycrypto=false
      - xm__xmpro__XMCryptography__TripleDES__Key=
    volumes:
      - ${CERTIFICATES_DIR:-./certs}/certs:/certs
      - ${CERTIFICATES_DIR:-./certs}/trustedcerts:/trustedcerts
  smdb:
    image: ${REGISTRY_URL:-xmprononprod.azurecr.io}/smdb:${REGISTRY_VERSION:-4.5.0.136-alpha-28faa02bab}
    environment:
      - SQLCMDSERVER=${DB_PROTOCOL:-tcp}:${DB_SERVER:-host.docker.internal}
      - SQLCMDENCRYPT=${DB_ENCRYPT:-true}
      - SQLCMDTRUSTSERVERCERTIFICATE=${DB_TRUST_SERVER_CERTIFICATE:-true}
      - SQLCMDUSER=${DB_SA_USER:-sa}
      - SQLCMDPASSWORD=${DB_SA_PASSWORD:-someSaPassword!}
    
      - SMDB_USER=${SMDB_USER:-someSmDbUser}
      - SMDB_PASSWORD=${SMDB_PASSWORD:-someSmDbPassword!}
  dsdb:
    image: ${REGISTRY_URL:-xmprononprod.azurecr.io}/dsdb:${REGISTRY_VERSION:-4.5.0.136-alpha-28faa02bab}
    environment:
      - SQLCMDSERVER=${DB_PROTOCOL:-tcp}:${DB_SERVER:-host.docker.internal}
      - SQLCMDENCRYPT=${DB_ENCRYPT:-true}
      - SQLCMDTRUSTSERVERCERTIFICATE=${DB_TRUST_SERVER_CERTIFICATE:-true}
      - SQLCMDUSER=${DB_SA_USER:-sa}
      - SQLCMDPASSWORD=${DB_SA_PASSWORD:-someSaPassword!}
    
      - DSDB_USER=${DSDB_USER:-someDsDbUser}
      - DSDB_PASSWORD=${DSDB_PASSWORD:-someDsDbPassword!}
